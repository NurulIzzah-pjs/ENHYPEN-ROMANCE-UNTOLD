<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <title>Your Title Here</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="./enhypen.css" />
    <style>
        /* Add your CSS styles here */
    </style>
</head>
<body>
    <div class="container">
        <div class="iphone-14-15-pro-max-1">
            <section class="iphone-14-15-pro-max-1-inner">
                <div class="frame-parent">
                    <div class="frame">
                        <img class="beige-1-icon" alt="" src="/INCEPTIO/beige.png" id="background" />
                        <div class="uploadphotohere" id="uploadphotohere">
                            <input type="file" id="fileInput" style="opacity: 0; width: 100%; height: 100%; position: absolute; left: 0; top: 0;" />
                            <div class="up-photo1" id="up-photo1"></div>
                        </div>
                        <img class="jk-1-icon" loading="lazy" alt="" src="/INCEPTIO/JK.png" id="mainImage" />
                    </div>
                    <div class="won-parent">
                        <div class="won" onclick="changeImage('/INCEPTIO/JW.png')" ontouchend="changeImage('/INCEPTIO/JW.png')">
                            <div class="hsbutton"></div>
                            <div class="jungwon">Jungwon</div>
                        </div>
                        <div class="hee" onclick="changeImage('/INCEPTIO/HS.png')" ontouchend="changeImage('/INCEPTIO/HS.png')">
                            <div class="hsbutton1"></div>
                            <div class="heeseung">Heeseung</div>
                        </div>
                        <div class="jay" onclick="changeImage('/INCEPTIO/JY.png')" ontouchend="changeImage('/INCEPTIO/JY.png')">
                            <div class="jybutton"></div>
                            <div class="jay1">Jay</div>
                        </div>
                        <div class="jake" onclick="changeImage('/INCEPTIO/JK.png')" ontouchend="changeImage('/INCEPTIO/JK.png')">
                            <div class="jkbutton"></div>
                            <div class="jake1">Jake</div>
                        </div>
                        <div class="hoon" onclick="changeImage('/INCEPTIO/SH.png')" ontouchend="changeImage('/INCEPTIO/SH.png')">
                            <div class="shbutton"></div>
                            <div class="sunghoon">Sunghoon</div>
                        </div>
                        <div class="ddeonu" onclick="changeImage('/INCEPTIO/SN.png')" ontouchend="changeImage('/INCEPTIO/SN.png')">
                            <div class="snbutton"></div>
                            <div class="sunoo">
                                <p class="sunoo1">Sunoo</p>
                            </div>
                        </div>
                        <div class="riki" onclick="changeImage('/INCEPTIO/NK.png')" ontouchend="changeImage('/INCEPTIO/NK.png')">
                            <div class="nkbutton"></div>
                            <div class="ni-ki">Ni-ki</div>
                        </div>
                    </div>
                    <div class="frame-group">
                        <div class="upload-options-wrapper">
                            <div class="upload-options">
                                <div class="upload" id="upload">
                                    <div class="uploadbutton" id="uploadButton"></div>
                                    <div class="upload-photo">Upload Photo</div>
                                </div>
                                <div class="save" id="saveEditButton" onclick="confirmEdit()" ontouchend="confirmEdit()">
                                    <div class="savebutton"></div>
                                    <div class="save-edit">Save Edit</div>
                                </div>
                                <div class="download" id="downloadButton" onclick="prepareCardDownload()" ontouchend="prepareCardDownload()">
                                    <div class="dlbutton"></div>
                                    <div class="download1">Download</div>
                                </div>
                            </div>
                        </div>
                        <div class="frame-container">
                            <div class="frame-colour-wrapper">
                                <div class="frame-colour">Frame colour :</div>
                            </div>
                            <div class="inceptio-parent">
                                <div class="inceptio" onclick="changeBG('/INCEPTIO/beige.png')" ontouchend="changeBG('/INCEPTIO/beige.png')">
                                    <div class="ibutton"></div>
                                    <div class="inceptio1">Inceptio</div>
                                </div>
                                <div class="arcanum" onclick="changeBG('/INCEPTIO/teal.png')" ontouchend="changeBG('/INCEPTIO/teal.png')">
                                    <div class="abutton"></div>
                                    <div class="arcanum1">
                                        <p class="arcanum2">Arcanum</p>
                                    </div>
                                </div>
                                <div class="concessio" onclick="changeBG('/INCEPTIO/blue.png')" ontouchend="changeBG('/INCEPTIO/blue.png')">
                                    <div class="cbutton"></div>
                                    <div class="concessio1">Concessio</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <img class="credit-1-icon" alt="" src="/INCEPTIO/credit.png" />
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        function changeImage(newSrc) {
            document.getElementById('mainImage').src = newSrc;
        }

        function changeBG(newSrc) {
            document.getElementById('background').src = newSrc;
        }
        
        var imagesLoaded = false; // Track if images are loaded

        function loadImagesBeforeDownload() {
            var images = document.querySelectorAll('.frame img');
            var promises = [];

            images.forEach(function(img) {
                promises.push(loadImage(img.src));
            });

            Promise.all(promises).then(function() {
                imagesLoaded = true;
                document.getElementById('downloadButton').disabled = false;
            }).catch(function(error) {
                console.error('Error loading images:', error);
                throw error; // Propagate the error
            });
        }

        function loadImage(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve();
                img.onerror = () => reject();
                img.src = url;
            });
        }

        function prepareCardDownload() {
            if (!imagesLoaded) {
                loadImagesBeforeDownload(); // Load images if not already loaded
            } else {
                downloadCard(); // Images are already loaded, proceed to download
            }
        }

        // Function to download the card
        function downloadCard() {
            if (!imagesLoaded) {
                console.log('Images are not loaded yet.');
                return;
            }

            var cardElement = document.querySelector('.frame');

            // Get dimensions of the card area
            var rect = cardElement.getBoundingClientRect();
            var width = rect.width;
            var height = rect.height;

            var scale = 10; // Example: Increase resolution by 10x
            var scaledWidth = width * scale;
            var scaledHeight = height * scale;

            var options = {
                width: scaledWidth,
                height: scaledHeight,
                style: {
                    transform: 'scale(' + scale + ')', // Scale up for higher resolution
                    transformOrigin: 'top left', // Set transform origin to top left corner
                    'text-shadow': '0 2px 4px rgba(0, 0, 0, 0.5)' // Ensure text-shadow is included
                },
                filter: function(node) {
                    return (node.tagName !== 'i');
                }
            };

            domtoimage.toBlob(cardElement, options).then(function(blob) {
                window.saveAs(blob, 'card.png');
            }).catch(function(error) {
                console.error('Error generating image:', error);
                alert('Failed to download the card. Please try again.');
            });
        }

        // Upload photo functionality
        $(document).ready(function() {
            $("#uploadButton").click(function() {
                $("#fileInput").click();
            });

            $("#fileInput").change(function(e) {
                var reader = new FileReader();
                reader.onload = function(event) {
                    var img = $('<img>').attr('src', event.target.result).addClass('uploaded-image');
                    $("#up-photo1").html(img);
                }
                reader.readAsDataURL(e.target.files[0]);
            });
        });
    </script>
</body>
</html>


